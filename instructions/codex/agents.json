{
  "agents": [
    {
      "name": "rightsize",
      "description": "Check if Kubernetes deployment resources match RightSize API recommendations and update configurations",
      "instructions": "# RightSize Resource Checker\n\n## When to Use\n\nUse this skill when you need to:\n- Check if a service's CPU/memory resources are appropriately sized\n- Update Kubernetes deployment configurations based on usage recommendations\n- Audit resource allocation across services\n- Optimize infrastructure costs\n\n## How It Works\n\n### 1. Extract Project Information\n\n- Find `project_namespace` in `.gitlab-ci.yml` (under `include.inputs.project_namespace`)\n- Find app name from `fullnameOverride` in deploy folder (usually `/deploy/base/values.yaml`)\n\n### 2. Query RightSize API\n\nFor each region (sg, my, co.th, ae, hk):\n\n**CPU Recommendations:**\n```\nGET https://rightsize-api.production.stashaway.{region}/resource-recommendation/cpu?app={app}&namespace={namespace}\n```\n\n**Memory Recommendations:**\n```\nGET https://rightsize-api.production.stashaway.{region}/resource-recommendation/memory?app={app}&namespace={namespace}\n```\n\n**Response Format:**\n```json\n[\n  {\n    \"container\": \"app-container-name\",\n    \"requests\": 0.605283630945885,\n    \"limits\": \"null\"\n  },\n  {\n    \"container\": \"istio-proxy\",\n    \"requests\": 0.0483945427650614,\n    \"limits\": \"null\"\n  }\n]\n```\n\n**Note**: API may return \"null\" as a string; treat it as actual null.\n\n### 3. Check Deployment Resources\n\nLook for resource definitions in:\n- `/deploy/base/values.yaml` (base configuration)\n- `/deploy/{region}-{env}/values.yaml` (environment-specific overrides)\n\nResource locations:\n- Main container: `resources.requests` and `resources.limits`\n- Istio sidecar: `istio.sidecar.resources.requests` and `istio.sidecar.resources.limits`\n\n### 4. Compare and Recommend\n\n- Compare current values with recommendations\n- Allow rounding up recommendations to clean numbers\n- Keep existing settings if they're within 30% of recommendations\n- Flag resources that exceed recommendations by >30%\n\n### 5. Update Resources and Commit Changes\n\n**This skill should automatically update files and commit changes** (not just recommend):\n\n1. **Update values.yaml files**:\n   - Modify `/deploy/base/values.yaml` and/or `/deploy/{region}-{env}/values.yaml`\n   - Update `resources.requests` and `resources.limits` for main container\n   - Update `istio.sidecar.resources.requests` and `istio.sidecar.resources.limits` if present\n   - Apply rounding where appropriate (round up to clean numbers)\n   - Preserve existing values if within 30% tolerance\n\n2. **Commit the changes**:\n   - Create a commit with message following StashAway conventions\n   - Use format: `chore: <ticket-number> Right-size resources for <app-name>`\n   - Include details in commit body about what was changed and why\n\n3. **User confirmation**:\n   - Show summary of changes before applying\n   - Ask for confirmation: \"Apply these changes and commit?\"\n   - If user confirms, update files and create commit\n   - If user declines, only show recommendations without changes\n\n## Example Usage\n\n```\nUser: Can you check if this service is rightsized?\nAgent: I'll check the rightsize recommendations for this service.\n[Extracts namespace and app name]\n[Queries RightSize API for all regions]\n[Compares with current deploy configs]\n[Reports findings and suggests updates]\n```\n\n## Important Notes\n\n- Always query all regions (sg, my, co.th, ae, hk) for complete analysis\n- Consider production environments have higher priority\n- Round recommendations to clean numbers (e.g., 0.605 → 0.6 or 0.65)\n- Never reduce resources that are already under-provisioned\n- Include ticket number in commit message if available from branch name\n- Test changes in staging before applying to production",
      "trigger": "/rightsize"
    },
    {
      "name": "commit-message",
      "description": "Format commit messages according to StashAway conventions with automatic ticket extraction",
      "instructions": "# Commit Message Formatter\n\n## When to Use\n\nUse this skill when creating git commits to ensure messages follow team standards.\n\n## Branch Naming Convention\n\nBranches should follow this format:\n```\n<type>/<ticket-number>-<short-description-in-kebab-case>\n```\n\n**Examples**:\n- `feat/SA-604-add-execution-mode-to-kafka-topic`\n- `fix/SA-1234-prevent-xss-in-user-input`\n- `chore/SA-789-upgrade-dependencies`\n- `refactor/SA-456-extract-auth-logic`\n\n**Extracting Ticket Number from Branch**:\n- If branch follows naming convention, extract ticket number automatically\n- If branch doesn't contain ticket number (e.g., `main`, `develop`, `feature-branch`), ask user for it\n- User can skip providing ticket number if not applicable\n\n## Commit Message Format\n\n```\n<type><(optional scope)>: <ticket number> <subject>\n\n<body>\n```\n\n### Components\n\n#### Type (Required)\n- `feat` - New features that change behavior\n- `fix` - Bug fixes\n- `chore` - Package upgrades, version bumps, maintenance\n- `refactor` - Code refactors that do NOT change behavior\n\n#### Scope (Optional)\nDefines the domain/area of the system:\n- Examples: `(security)`, `(localisation)`, `(goals)`, `(auth)`\n\n#### Ticket Number (Recommended but Optional)\n- **Recommended**: Always include ticket number when available\n- **Optional**: Can be omitted if no ticket exists (e.g., minor fixes, experiments)\n- **GitLab tickets**: Use `#123` format\n- **Jira tickets**: Use `ABC-123` format (e.g., `SA-604`)\n- **Multiple tickets**: Include all, e.g., `SA-604 #123`\n- **Auto-detection**: Try to extract from branch name first\n- **User prompt**: If not in branch name and not obvious, ask user (allow skip)\n\n#### Subject (Required)\n- Describes WHAT the commit does (not why or how)\n- Written in imperative mood: \"Add feature\" not \"Added feature\" or \"Adds feature\"\n- Concise and clear\n- Proper English spelling and grammar\n- No period at the end\n\n#### Body (Optional)\n- Explains WHY or HOW\n- Required only if context isn't clear from subject/ticket/code\n- Can use any format (paragraphs, bullets, etc.)\n- Proper English spelling and grammar\n\n## Examples\n\n### Example 1: Feature with multiple changes\n```\nfeat: SA-604 Improve slack events listening node\n\n- Add env to kafka topic to not interfere with prod execution if manual node execution is started\n- Delete grist records on node closure, to only have active n8n configs in grist table\n```\n\n### Example 2: Bug fix\n```\nfix: SA-1234 Prevent XSS in user input fields\n\nSanitize user input before rendering to prevent cross-site scripting attacks.\nAdded DOMPurify for client-side sanitization.\n```\n\n## Usage in AI Agent\n\nWhen the user asks to create a commit or commit message:\n\n1. Analyze the changes (use `git diff`, `git status`)\n2. Check current branch name (use `git branch --show-current`)\n3. Try to extract ticket number from branch name:\n   - Look for pattern: `<type>/<TICKET-NUMBER>-<description>`\n   - Example: `feat/SA-604-add-feature` → ticket is `SA-604`\n4. If no ticket in branch name:\n   - Ask user: \"What's the ticket number for this change? (or press Enter to skip)\"\n   - Allow user to skip if no ticket exists\n5. Identify the type of change (feat, fix, chore, refactor)\n6. Generate subject in imperative mood\n7. Add body only if changes require explanation\n8. Present to user for approval\n\n## Anti-patterns to Avoid\n\n❌ `feat: Added new feature` (not imperative)\n❌ `fix: Fix bug.` (period at end)\n❌ `Update code` (missing type and ticket)\n❌ `feat: Did some changes` (vague subject)\n✅ `feat: SA-123 Add user authentication` (correct)\n\n## Tips for Good Commits\n\n1. **Keep commits atomic**: One logical change per commit\n2. **Write for reviewers**: Make it easy to understand what and why\n3. **Reference tickets**: Helps with traceability and project management\n4. **Use present tense**: \"Add feature\" not \"Added feature\"\n5. **Be specific**: \"Fix login timeout\" not \"Fix bug\"\n6. **Explain why**: Use body to explain motivation if not obvious",
      "trigger": "/commit-message"
    }
  ]
}
